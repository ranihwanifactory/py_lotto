import pyautogui
import pyperclip
import time

# --- 설정 --- #
# pyautogui의 fail-safe 기능을 활성화합니다.
# 마우스를 화면의 왼쪽 상단 (0,0)으로 빠르게 이동하면 스크립트가 즉시 중단됩니다.
pyautogui.FAILSAFE = True

# 메시지를 보낼 대상 친구 목록
target_contacts = ["도형쓰","김진환"]

# 보낼 메시지 내용
message_content = "테스트입니다."

# 각 동작 사이의 지연 시간 설정 (초 단위)
# 컴퓨터 성능과 카카오톡 반응 속도에 따라 조절할 수 있습니다.
delay_short = 0.5   # 짧은 지연
delay_medium = 1.0  # 중간 지연
delay_long = 2.0    # 긴 지연

# --- 스크립트 실행 방법 --- #
# 1. Python과 필요한 라이브러리 (pyautogui, pyperclip)가 설치되어 있는지 확인합니다.
#    설치되지 않았다면, 명령 프롬프트(cmd) 또는 터미널에서 다음을 실행하세요:
#    pip install pyautogui pyperclip
# 2. KakaoTalk PC 버전을 실행하고, 스크립트 실행 전에 KakaoTalk 창이 활성화되어 있도록 준비하세요.
# 3. 이 스크립트를 실행한 후, 약 5초 안에 KakaoTalk 창으로 전환하세요.
# 4. 스크립트가 자동으로 카카오톡 메시지를 전송합니다.
# 5. 스크립트가 예상대로 작동하지 않거나 중단하고 싶다면, 마우스 커서를 화면의 왼쪽 상단 모서리(0,0)로 빠르게 이동하세요.

print("스크립트 시작 중... 5초 안에 카카오톡 창을 활성화하세요.")
time.sleep(5) # 사용자가 카카오톡으로 전환할 시간을 줍니다.

try:
    for contact_name in target_contacts:
        print(f"'{contact_name}'님에게 메시지 전송 시도...")

        # 카카오톡 검색 바 활성화 (Ctrl+F) - 채팅 목록 검색
        # 이 단축키는 대부분의 카카오톡 PC 버전에서 작동합니다.
        pyautogui.hotkey('ctrl', 'f')
        time.sleep(delay_short)

        # 연락처 이름 입력
        pyautogui.write(contact_name)
        time.sleep(delay_short)

        # Enter 키를 눌러 검색 결과 중 첫 번째 채팅방으로 이동
        pyautogui.press('enter')
        time.sleep(delay_medium) # 채팅방이 열릴 때까지 기다립니다.

        # 메시지 내용을 클립보드에 복사
        pyperclip.copy(message_content)

        # 클립보드 내용 붙여넣기 (Ctrl+V)
        pyautogui.hotkey('ctrl', 'v')
        time.sleep(delay_short)

        # 메시지 전송 (Enter)
        pyautogui.press('enter')
        time.sleep(delay_medium) # 메시지 전송 후 잠시 기다립니다.

        print(f"'{contact_name}'님에게 메시지를 성공적으로 전송했습니다.")

        # 현재 채팅방을 닫고 메인 채팅 목록으로 돌아가기 (Esc)
        # 다음 연락처 검색을 위해 초기화하는 과정입니다.
        pyautogui.press('esc')
        time.sleep(delay_short)

    print("모든 대상에게 메시지 전송을 완료했습니다.")

except pyautogui.FailSafeException:
    print("스크립트가 Fail-Safe에 의해 중단되었습니다. (마우스를 왼쪽 상단으로 이동)")
except Exception as e:
    print(f"오류가 발생했습니다: {e}")
    print("스크립트 실행 중 문제가 발생했습니다. 카카오톡이 활성화되어 있는지, "
          "또는 단축키가 제대로 작동하는지 확인해주세요.")
